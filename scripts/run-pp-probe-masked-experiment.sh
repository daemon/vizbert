python -m vizbert.run.train_pp_probe --dual -df ${DATA} --layer-idx ${LAYER} --model bert-base-uncased --load-weights ${MODEL_WORKSPACE} -d ${TASK} --lr 1e-2 --probe-rank ${PROBE_RANK} --objective concept --workspace workspaces/pp-probe-${TASK}-r${PROBE_RANK}-l${LAYER}-m$(echo ${MASK_CLASSES} | sed "s/ //g") --num-epochs ${NUM_EPOCHS} --no-mask-first --inverse -msl ${MSL} --mask-classes ${MASK_CLASSES}
echo "Baseline no probe"
python -m vizbert.run.finetune_classification -df ${DATA} -d ${TASK} -w ${MODEL_WORKSPACE} --num-warmup-steps 100 --num-epochs 30 --lr 5e-4 -msl ${MSL} -bsz 16 --load-weights --eval-only
echo "Baseline class filtered"
python -m vizbert.run.finetune_classification -df ${DATA} -d ${TASK} -w ${MODEL_WORKSPACE} --num-warmup-steps 100 --num-epochs 30 --lr 5e-4 -msl ${MSL} -bsz 16 --load-weights --eval-only --no-mask-first --filter-labels ${MASK_CLASSES}
python -m vizbert.run.finetune_classification -df ${DATA} -d ${TASK} -w ${MODEL_WORKSPACE} --num-warmup-steps 100 --num-epochs 30 --lr 5e-4 -msl ${MSL} -bsz 16 --load-weights --eval-only --no-mask-first --filter-labels ${MASK_CLASSES} --invert-filter
echo "Baseline probe no class filter"
python -m vizbert.run.finetune_classification -df ${DATA} -d ${TASK} -w ${MODEL_WORKSPACE} --num-warmup-steps 100 --num-epochs 30 --lr 5e-4 -msl ${MSL} -bsz 16 --load-weights --eval-only --probe-path workspaces/pp-probe-${TASK}-r${PROBE_RANK}-l${LAYER}-m$(echo ${MASK_CLASSES} | sed "s/ //g") --probe-rank ${PROBE_RANK} --layer-idx ${LAYER} --no-mask-first
echo "Project onto"
python -m vizbert.run.finetune_classification -df ${DATA} -d ${TASK} -w ${MODEL_WORKSPACE} --num-warmup-steps 100 --num-epochs 30 --lr 5e-4 -msl ${MSL} -bsz 16 --load-weights --eval-only --probe-path workspaces/pp-probe-${TASK}-r${PROBE_RANK}-l${LAYER}-m$(echo ${MASK_CLASSES} | sed "s/ //g") --probe-rank ${PROBE_RANK} --layer-idx ${LAYER} --no-mask-first --filter-labels ${MASK_CLASSES}
python -m vizbert.run.finetune_classification -df ${DATA} -d ${TASK} -w ${MODEL_WORKSPACE} --num-warmup-steps 100 --num-epochs 30 --lr 5e-4 -msl ${MSL} -bsz 16 --load-weights --eval-only --probe-path workspaces/pp-probe-${TASK}-r${PROBE_RANK}-l${LAYER}-m$(echo ${MASK_CLASSES} | sed "s/ //g") --probe-rank ${PROBE_RANK} --layer-idx ${LAYER} --no-mask-first --filter-labels ${MASK_CLASSES} --invert-filter
echo "Project out"
python -m vizbert.run.finetune_classification -df ${DATA} -d ${TASK} -w ${MODEL_WORKSPACE} --num-warmup-steps 100 --num-epochs 30 --lr 5e-4 -msl ${MSL} -bsz 16 --load-weights --eval-only --probe-path workspaces/pp-probe-${TASK}-r${PROBE_RANK}-l${LAYER}-m$(echo ${MASK_CLASSES} | sed "s/ //g") --probe-rank ${PROBE_RANK} --layer-idx ${LAYER} --inverse --no-mask-first --filter-labels ${MASK_CLASSES}
python -m vizbert.run.finetune_classification -df ${DATA} -d ${TASK} -w ${MODEL_WORKSPACE} --num-warmup-steps 100 --num-epochs 30 --lr 5e-4 -msl ${MSL} -bsz 16 --load-weights --eval-only --probe-path workspaces/pp-probe-${TASK}-r${PROBE_RANK}-l${LAYER}-m$(echo ${MASK_CLASSES} | sed "s/ //g") --probe-rank ${PROBE_RANK} --layer-idx ${LAYER} --inverse --no-mask-first --filter-labels ${MASK_CLASSES} --invert-filter
echo "Visualize"
python -m vizbert.run.visualize_probe -df ${DATA} -d ${TASK} --load-weights ${MODEL_WORKSPACE} --model bert-base-uncased -l ${LAYER} --workspace workspaces/pp-probe-${TASK}-r${PROBE_RANK}-l${LAYER}-m$(echo ${MASK_CLASSES} | sed "s/ //g") --probe-rank ${PROBE_RANK} --output-folder visuals/pp-probe-${TASK}-r${PROBE_RANK}-l${LAYER}-m$(echo ${MASK_CLASSES} | sed "s/ //g") --limit 200 --inverse
